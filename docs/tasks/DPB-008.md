# DPB-008: GitHub Actions ワークフロー設定

## 基本情報

| 項目       | 内容                            |
| ---------- | ------------------------------- |
| タスクID   | DPB-008                         |
| タスク名   | GitHub Actions ワークフロー設定 |
| Phase      | Phase 2: 統合・デプロイ         |
| 優先度     | 必須                            |
| ステータス | 未着手                          |
| 関連機能ID | F-05, F-14 (仕様書 Sec. 5, 14)  |
| 関連画面ID | -                               |

## 概要

アプリケーションをGitHub Actions上で定期実行するためのワークフローを定義します。また、MVPの永続化要件である `posted.json` の自動コミット＆プッシュも実装します。

## やること

- [ ] `.github/workflows/daily.yml` を作成する。
- [ ] `schedule` トリガーで毎日定刻（JST 09:00）に実行されるように設定する。
- [ ] `workflow_dispatch` トリガーで手動実行も可能にする。
- [ ] Go言語のセットアップ、依存関係のインストール、ビルド、実行のステップを定義する。
- [ ] `data/posted.json` に変更があった場合、リポジトリに自動でコミット＆プッシュする処理を追加する。
- [ ] 必要な設定値をGitHub Secretsおよび環境変数としてワークフローに渡す。

## 方針

- Goのセットアップには `actions/setup-go` を使用する。
- リポジトリへの書き込み権限を持つ `GITHUB_TOKEN` を利用する。
- `posted.json` の変更を検知し、コミット＆プッシュするステップには、`stefanzweifel/git-auto-commit-action` のような既存アクションを利用するか、自前のスクリプトを記述する。

## 方法

### 1. daily.yml の実装

```yaml
# .github/workflows/daily.yml
name: Daily Paper Bot

on:
  workflow_dispatch: # 手動実行
  schedule:
    - cron: "0 0 * * *" # UTC 00:00 (JST 09:00)

jobs:
  run-bot:
    runs-on: ubuntu-latest
    permissions:
      contents: write # リポジトリへの書き込み権限

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.21" # プロジェクトで使用するGoのバージョン

      - name: Run Bot
        env:
          OR_VENUE: "ICLR.cc/2025/Conference"
          OR_YEAR: "2025"
          TARGET_PLATFORM: "slack"
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          SLACK_CHANNEL_ID: ${{ secrets.SLACK_CHANNEL_ID }}
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: go run ./cmd/dailybot

      - name: Commit and push posted.json
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: Update posted papers"
          file_pattern: "data/posted.json"
          commit_user_name: "github-actions[bot]"
          commit_user_email: "github-actions[bot]@users.noreply.github.com"
          commit_author: "github-actions[bot] <github-actions[bot]@users.noreply.github.com>"
```

## 成果物

- [ ] `daily.yml` ワークフローファイル

## 依存タスク

- DPB-007: メインプロセスと実行フローの統括

## 後続タスク

なし（MVP完了）
