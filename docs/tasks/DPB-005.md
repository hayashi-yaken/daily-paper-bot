# DPB-005: 論文選定ロジック実装

## 基本情報

| 項目       | 内容                 |
| ---------- | -------------------- |
| タスクID   | DPB-005              |
| タスク名   | 論文選定ロジック実装 |
| Phase      | Phase 1: コア機能    |
| 優先度     | 必須                 |
| ステータス | 未着手               |
| 関連機能ID | F-08 (仕様書 Sec. 8) |
| 関連画面ID | -                    |

## 概要

OpenReviewから取得した論文リストの中から、「今日の論文」として投稿する1本を選定するロジックを実装します。

## やること

- [ ] `internal/selector` パッケージを作成する。
- [ ] 論文リストと投稿済みIDリストを受け取り、未投稿の論文のみを抽出するフィルタリング処理を実装する。
- [ ] 未投稿論文のリストから、仕様に基づいた戦略（MVPではランダム）で1本を選出する。
- [ ] 未投稿論文が1本も存在しない場合のハンドリングを実装する（投稿なし）。
- [ ] 必須項目（paper_id, title）が欠落している論文を候補から除外する。

## 方針

- `Selector` というインターフェースを定義し、将来的に選定戦略（`random`, `latest`など）を切り替えられるように設計する。
- MVPでは `RandomSelector` のみを実装する。
- 乱数のシードには現在時刻などを用いる (`math/rand`)。

## 方法

### 1. Selectorインターフェースの定義

```go
// internal/selector/selector.go
package selector

import "daily-paper-bot/internal/openreview"

// Paper は selector が要求する論文のインターフェース
type Paper interface {
	GetID() string
	GetTitle() string
}

// Selector は論文を選定するロジックのインターフェース
type Selector interface {
	Select(papers []Paper) (Paper, error)
}
```

### 2. ランダム選定ロジックの実装

```go
// internal/selector/random.go
package selector

import (
	"errors"
	"math/rand"
	"time"
)

var ErrNoCandidates = errors.New("no candidates to select from")

type RandomSelector struct {
	// isPosted は論文が投稿済みか判定する関数
	isPosted func(paperID string) bool
}

func NewRandomSelector(isPosted func(paperID string) bool) *RandomSelector {
	return &RandomSelector{isPosted: isPosted}
}

func (s *RandomSelector) Select(papers []Paper) (Paper, error) {
	var candidates []Paper

	// 投稿済みを除外し、必須項目をチェック
	for _, p := range papers {
		if p.GetID() == "" || p.GetTitle() == "" {
			continue // データ不整合はスキップ
		}
		if !s.isPosted(p.GetID()) {
			candidates = append(candidates, p)
		}
	}

	if len(candidates) == 0 {
		return nil, ErrNoCandidates
	}

	// ランダムに1本選定
	rand.Seed(time.Now().UnixNano())
	selectedIndex := rand.Intn(len(candidates))

	return candidates[selectedIndex], nil
}
```

## 成果物

- [ ] `internal/selector` パッケージ
- [ ] 未投稿論文からランダムに1本を選定する `RandomSelector`
- [ ] ユニットテスト

## 依存タスク

- DPB-003: OpenReviewクライアント実装
- DPB-004: 投稿記録ストレージ機能

## 後続タスク

- DPB-007: メインプロセスと実行フローの統括
