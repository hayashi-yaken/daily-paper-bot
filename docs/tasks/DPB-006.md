# DPB-006: é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSlack/Discordï¼‰

## åŸºæœ¬æƒ…å ±

| é …ç›®       | å†…å®¹                          |
| ---------- | ----------------------------- |
| ã‚¿ã‚¹ã‚¯ID   | DPB-006                       |
| ã‚¿ã‚¹ã‚¯å   | é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSlack/Discordï¼‰ |
| Phase      | Phase 1: ã‚³ã‚¢æ©Ÿèƒ½             |
| å„ªå…ˆåº¦     | å¿…é ˆ                          |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å®Œäº†                          |
| é–¢é€£æ©Ÿèƒ½ID | F-09 (ä»•æ§˜æ›¸ Sec. 9)          |
| é–¢é€£ç”»é¢ID | -                             |

## æ¦‚è¦

é¸å®šã•ã‚ŒãŸè«–æ–‡ã®æƒ…å ±ã‚’æ•´å½¢ã—ã€æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆSlackã¾ãŸã¯Discordï¼‰ã«æŠ•ç¨¿ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

## ã‚„ã‚‹ã“ã¨

- [x] `internal/formatter` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã€è«–æ–‡æƒ…å ±ã‹ã‚‰æŠ•ç¨¿ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚
- [x] `internal/notifier` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚
- [x] `Notifier` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã€ãã‚Œã‚’å®Ÿè£…ã—ãŸ `SlackNotifier` ã¨ `DiscordNotifier` ã‚’ä½œæˆã™ã‚‹ã€‚
- [x] `SlackNotifier` ã¯ã€Slack APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã™ã‚‹ã€‚
- [x] `DiscordNotifier` ã¯ã€Webhook URLã«å¯¾ã—ã¦HTTP POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã™ã‚‹ã€‚
- [x] AbstractãŒé•·ã„å ´åˆã«æŒ‡å®šæ–‡å­—æ•°ã§åˆ‡ã‚Šè©°ã‚ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€‚
- [x] æŠ•ç¨¿å¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã™ã‚‹ã€‚

## æ–¹é‡

- **Formatter**: è«–æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€ä»•æ§˜æ›¸é€šã‚Šã®Markdownæ–‡å­—åˆ—ã‚’è¿”ã™è²¬å‹™ã‚’æŒã¤ã€‚
- **Notifier**: FormatterãŒç”Ÿæˆã—ãŸæ–‡å­—åˆ—ã‚’å—ã‘å–ã‚Šã€å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¸é€šçŸ¥ã™ã‚‹è²¬å‹™ã‚’æŒã¤ã€‚
- **Slack**: `slack-go/slack` ãªã©ã®å®Ÿç¸¾ã‚ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã™ã‚‹ã€‚
- **Discord**: æ¨™æº–ã® `net/http` ã§Webhookã«POSTã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã¨ã™ã‚‹ã€‚

## æ–¹æ³•

### 1. Formatterã®å®Ÿè£…

```go
// internal/formatter/formatter.go
package formatter

import (
	"fmt"
	"strings"

	"github.com/hayashi-yaken/daily-paper-bot/internal/openreview"
)

// FormatPaper ã¯è«–æ–‡æƒ…å ±ã‹ã‚‰æŠ•ç¨¿ç”¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ–‡å­—åˆ—ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
func FormatPaper(paper openreview.Note, venue string, year int, abstractMaxChars int) string {
	// Abstractã‚’æŒ‡å®šæ–‡å­—æ•°ã§åˆ‡ã‚Šè©°ã‚ã‚‹
	abstract := paper.Content.Abstract.Value
	if abstractMaxChars > 0 && len([]rune(abstract)) > abstractMaxChars {
		abstract = string([]rune(abstract)[:abstractMaxChars]) + "..."
	}

	// è‘—è€…ãƒªã‚¹ãƒˆã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã®æ–‡å­—åˆ—ã«ã™ã‚‹
	authors := strings.Join(paper.Content.Authors.Value, ", ")

	// PDFã®URLã‚’å–å¾—ã™ã‚‹ã€‚ãªã‘ã‚Œã°OpenReviewã®ãƒ•ã‚©ãƒ¼ãƒ©ãƒ URLã‚’ç”Ÿæˆã™ã‚‹ã€‚
	link := paper.Content.PDF.Value
	if link == "" {
		link = fmt.Sprintf("https://openreview.net/forum?id=%s", paper.ID)
	}

	// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çµ„ã¿ç«‹ã¦ã‚‹
	return fmt.Sprintf(
		"ğŸ“„ ä»Šæ—¥ã®è«–æ–‡ (%s %d)\n\n*Title*: %s\n*Authors*: %s\n\n*Abstract*:\n%s\n\n*Link*:\n%s\n\nID: `%s`",
		venue,
		year,
		paper.Content.Title.Value,
		authors,
		abstract,
		link,
		paper.ID,
	)
}
```


### 2. Notifierã®å®Ÿè£…

```go
// internal/notifier/notifier.go
package notifier

// Notifier ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€šçŸ¥ã™ã‚‹
type Notifier interface {
	Post(message string) error
}

// --- Slack ---
// internal/notifier/slack.go
import "github.com/slack-go/slack"

type SlackNotifier struct {
	client    *slack.Client
	channelID string
}
// ... NewSlackNotifier, Post ...

// --- Discord ---
// internal/notifier/discord.go
import "net/http"

type DiscordNotifier struct {
	webhookURL string
	httpClient *http.Client
}
// ... NewDiscordNotifier, Post ...
```

## æˆæœç‰©

- [x] `internal/formatter` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- [x] `internal/notifier` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆSlack/Discordå®Ÿè£…ã‚’å«ã‚€ï¼‰
- [x] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

## ä¾å­˜ã‚¿ã‚¹ã‚¯

- DPB-001: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸè¨­å®šã¨åŸºæœ¬æ§‹é€ 

## å¾Œç¶šã‚¿ask

- DPB-007: ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã¨å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã®çµ±æ‹¬
