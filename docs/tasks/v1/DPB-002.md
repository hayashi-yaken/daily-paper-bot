# DPB-002: 設定管理機能

## 基本情報

| 項目       | 内容                 |
| ---------- | -------------------- |
| タスクID   | DPB-002              |
| タスク名   | 設定管理機能         |
| Phase      | Phase 1: 基盤構築    |
| 優先度     | 必須                 |
| ステータス | 完了                 |
| 関連機能ID | F-07 (仕様書 Sec. 7) |
| 関連画面ID | -                    |

## 概要

アプリケーションの動作に必要な設定値を、環境変数およびGitHub Secretsから読み込むための機能を実装します。

## やること

- [x] 設定値を保持する構造体（struct）を `internal/config` に定義する。
- [x] 環境変数を読み込み、構造体にマッピングするローダーを実装する。
- [x] 必須項目が設定されていない場合にエラーを返すバリデーション処理を実装する。
- [x] シークレット情報（Token, Webhook URL）がログに出力されないよう注意する。

## 方針

- Goの標準ライブラリ `os.Getenv` を使用して環境変数を読み込む。
- `strconv` パッケージを利用して、文字列以外の型（整数など）への変換を行う。
- 設定項目は仕様書「7.2 設定項目」を網羅する。

## 方法

### 1. 設定構造体の定義

```go
// internal/config/config.go
package config

type Config struct {
	// OpenReview
	Venue string `env:"OR_VENUE,required"`
	Year  int    `env:"OR_YEAR,required"`

	// Target Platform
	TargetPlatform string `env:"TARGET_PLATFORM,required"`

	// Slack
	SlackBotToken  string `env:"SLACK_BOT_TOKEN"`
	SlackChannelID string `env:"SLACK_CHANNEL_ID"`

	// Discord
	DiscordWebhookURL string `env:"DISCORD_WEBHOOK_URL"`

	// Selector
	SelectStrategy    string `env:"SELECT_STRATEGY,default=random"`
	AbstractMaxChars  int    `env:"ABSTRACT_MAX_CHARS,default=1200"`
	DryRun            bool   `env:"DRY_RUN,default=false"`
}
```

> _補足: 上記は `env` タグを使ったライブラリ（例: `github.com/caarlos0/env`）の利用を想定した例。標準ライブラリのみで実装しても良い。_

### 2. ローダーの実装

```go
// internal/config/loader.go
package config

import (
	"os"
	"strconv"
)

// Load は環境変数から設定を読み込む
func Load() (*Config, error) {
	cfg := &Config{}
	var err error

	cfg.Venue = os.Getenv("OR_VENUE")
	if cfg.Venue == "" {
		// 必須項目のバリデーションエラー
	}

	cfg.Year, err = strconv.Atoi(os.Getenv("OR_YEAR"))
	if err != nil {
		// 型変換エラー
	}

	// ... 他の項目も同様にロード ...

	// 投稿先に応じたバリデーション
	if cfg.TargetPlatform == "slack" {
		if cfg.SlackBotToken == "" || cfg.SlackChannelID == "" {
			// Slack用必須項目のバリデーションエラー
		}
	}

	return cfg, nil
}
```

## 成果物

- [x] `internal/config` パッケージ
- [x] 設定値を読み込む `Load()` 関数
- [x] ユニットテスト

## 依存タスク

- DPB-001: プロジェクト初期設定と基本構造

## 後続タスク

- DPB-007: メインプロセスと実行フローの統括
