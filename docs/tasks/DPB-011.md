# DPB-011: 複数学会対応のメインプロセス統合

## 基本情報

| 項目       | 内容                             |
| ---------- | -------------------------------- |
| タスクID   | DPB-011                          |
| タスク名   | 複数学会対応のメインプロセス統合 |
| Phase      | Phase 3: 拡張機能                |
| 優先度     | 高                               |
| ステータス | 完了                             |
| 関連機能ID | -                                |
| 関連画面ID | -                                |

## 概要

`DPB-009` で改修した設定機能と、`DPB-010` で実装した学会選定ロジックを `cmd/dailybot/main.go` のメインプロセスに組み込みます。これにより、Botの実行ごとに対象となる学会がランダムに変わるようになります。

## やること

- [x] `main.go` の `run` 関数を修正する。
- [x] アプリケーション起動後、まず `VenueSelector` を使ってその日に処理する学会を1つ決定する。
- [x] 決定した学会の情報を、`OpenReviewクライアント` や `Formatter` に渡して処理を続行させる。
- [x] ログに、どの学会が選ばれたかを出力するようにする。
- [x] 既存の `OR_VENUE` などを使っている箇所を、選定した学会情報 (`VenueConfig`) を使うように置き換える。

## 方針

- `run` 関数の処理フローを、学会選定のステップが最初に来るように変更する。
- それ以外のコンポーネント（`storage`, `notifier`など）の使い方は基本的に変更しない。

## 方法

### 1. main.go の修正案

```go
// cmd/dailybot/main.go

func run() error {
	// 1. 設定を読み込み (DPB-009で修正済み)
	cfg, err := config.Load()
	if err != nil {
		return err
	}

	// 2. 実行対象の学会をランダムに選定 (DPB-010で実装)
	venueSelector := venueselector.NewRandomVenueSelector()
	selectedVenue, err := venueSelector.Select(cfg.Venues)
	if err != nil {
		return fmt.Errorf("failed to select venue: %w", err)
	}
	log.Printf("INFO: Selected venue for this run: %s %d", selectedVenue.Name, selectedVenue.Year)

	// 3. 各コンポーネントを初期化
	orClient := openreview.NewClient(cfg.CustomUserAgent)
	jsonStorage, err := storage.NewJSONStorage()
	// ... (Notifier, Formatterの初期化)

	// 4. OpenReviewから論文一覧を取得 (選定した学会のvenueを使う)
	notes, err := orClient.GetNotes(selectedVenue.Venue)
	// ...

	// 5. 論文を選定
	// ...

	// 6. 投稿メッセージを生成 (選定した学会の情報を渡す)
	message := paperFormatter.Format(selectedNote, selectedVenue.Name, selectedVenue.Year, cfg.AbstractMaxChars)
	// ...

	// 7. 投稿 & 記録 (選定した学会のvenueを記録)
	jsonStorage.Add(selectedPaper.GetID(), selectedVenue.Venue)
	// ...

	return nil
}
```

## 成果物

- [x] 複数学会対応のロジックが統合された `main.go`

## 依存タスク

- DPB-009: 複数学会対応のための設定機能改修
- DPB-010: 実行対象の学会を選定するロジックの実装

## 後続タスク

なし
