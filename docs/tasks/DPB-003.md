# DPB-003: OpenReviewクライアント実装

## 基本情報

| 項目       | 内容                       |
| ---------- | -------------------------- |
| タスクID   | DPB-003                    |
| タスク名   | OpenReviewクライアント実装 |
| Phase      | Phase 1: コア機能          |
| 優先度     | 必須                       |
| ステータス | 未着手                     |
| 関連機能ID | F-04 (仕様書 Sec. 4)       |
| 関連画面ID | -                          |

## 概要

OpenReview APIにアクセスし、指定されたカンファレンスの論文情報を取得するためのクライアントを実装します。

## やること

- [ ] `internal/openreview` パッケージを作成する。
- [ ] OpenReview APIのエンドポイントに対してHTTPリクエストを送信する機能を実装する。
- [ ] APIレスポンス（JSON）をパースし、Goの構造体にマッピングする。
- [ ] 仕様書で定義された必須項目（paper_id, title, authors, abstractなど）を取得する。
- [ ] APIリクエスト失敗時のエラーハンドリングを実装する。

## 方針

- Goの標準HTTPクライアント (`net/http`) を使用する。
- JSONのデコードには `encoding/json` を使用する。
- OpenReviewのAPI仕様（エンドポイント、パラメータ）を調査し、`venue` や `invitation` を指定して論文リストを取得する方法を確立する。
- APIからの取得結果を表現する `Paper` 構造体を定義する。

## 方法

### 1. Paper構造体の定義

```go
// internal/openreview/paper.go
package openreview

type Paper struct {
	ID       string   `json:"id"`
	Title    string   `json:"content.title"`
	Authors  []string `json:"content.authors"`
	Abstract string   `json:"content.abstract"`
	PDFURL   string   `json:"content.pdf"`
	Venue    string
	Year     int
}
```

> _補足: JSONタグは実際のAPIレスポンス構造に合わせる必要がある。上記はあくまで一例。_

### 2. クライアントの実装

```go
// internal/openreview/client.go
package openreview

import (
	"encoding/json"
	"fmt"
	"net/http"
)

type Client struct {
	httpClient *http.Client
}

func NewClient() *Client {
	return &Client{httpClient: &http.Client{}}
}

// GetPapers は指定されたVenueの論文を取得する
func (c *Client) GetPapers(venue string) ([]Paper, error) {
	// 例: https://api2.openreview.net/notes?invitation=ICLR.cc/2025/Conference/-/Submission
	url := fmt.Sprintf("https://api2.openreview.net/notes?invitation=%s/-/Submission", venue)

	req, err := http.NewRequest("GET", url, nil)
	if err != nil {
		return nil, fmt.Errorf("failed to create request: %w", err)
	}
	// APIによってはHeaderにUser-Agentなどが必要な場合がある
	// req.Header.Set("User-Agent", "daily-paper-bot/1.0")

	resp, err := c.httpClient.Do(req)
	if err != nil {
		return nil, fmt.Errorf("failed to execute request: %w", err)
	}
	defer resp.Body.Close()

	if resp.StatusCode != http.StatusOK {
		return nil, fmt.Errorf("unexpected status code: %d", resp.StatusCode)
	}

	// レスポンスのJSON構造を調べて、適切にデコードする
	var result struct {
		Notes []Paper `json:"notes"`
	}
	if err := json.NewDecoder(resp.Body).Decode(&result); err != nil {
		return nil, fmt.Errorf("failed to decode response: %w", err)
	}

	return result.Notes, nil
}
```

## 成果物

- [ ] `internal/openreview` パッケージ
- [ ] OpenReview APIから論文情報を取得する `GetPapers` 関数
- [ ] ユニットテスト（可能であればHTTPモックを使用）

## 依存タスク

- DPB-001: プロジェクト初期設定と基本構造

## 後続タスク

- DPB-007: メインプロセスと実行フローの統括
